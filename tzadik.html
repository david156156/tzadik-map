<!DOCTYPE html>
<html dir="rtl" lang="he">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>דף צדיק - מיקום קיברות צדיקים</title>
    <link rel="icon" type="image/x-icon" href="./אייקון.jpg" />
    <link rel="shortcut icon" type="image/x-icon" href="./אייקון.jpg" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
      }

      /* קרוסלה */
      .carousel-container {
        position: relative;
        overflow: hidden;
      }

      .carousel-track {
        display: flex;
        transition: transform 0.3s ease-in-out;
        gap: 0.75rem;
      }

      .carousel-item {
        flex: 0 0 auto;
        width: 200px;
        cursor: pointer;
      }

      @media (max-width: 640px) {
        .carousel-item {
          width: 150px;
        }
      }

      /* מודל תצוגה מלאה */
      .image-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 9999;
        justify-content: center;
        align-items: center;
      }

      .image-modal.active {
        display: flex;
      }

      .modal-image {
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
      }

      .modal-close {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
      }

      .modal-close:hover {
        background: white;
        transform: scale(1.1);
      }

      .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        z-index: 10;
      }

      .carousel-btn:hover {
        background: white;
        transform: translateY(-50%) scale(1.1);
      }

      .carousel-btn.prev {
        left: 10px;
      }

      .carousel-btn.next {
        right: 10px;
      }
    </style>
  </head>
  <body class="min-h-screen bg-[#FDFBF7] p-6">
    <!-- מודל תצוגה מלאה -->
    <div id="imageModal" class="image-modal">
      <div class="modal-close" onclick="closeImageModal()">
        <svg
          class="w-6 h-6 text-amber-900"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </div>
      <img id="modalImage" class="modal-image" src="" alt="" />
    </div>

    <div class="max-w-4xl mx-auto">
      <!-- כותרת עליונה -->
      <div class="flex justify-between items-center gap-4 mb-8">
        <div class="flex items-center gap-4">
          <a
            href="index.html"
            class="px-3 py-2 rounded-full bg-white border border-amber-200 text-amber-800 font-semibold shadow hover:bg-amber-50 transition"
            title="חזרה לרשימה"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M15 19l-7-7 7-7"
              />
            </svg>
          </a>
          <div>
            <h1 id="tzadikTitle" class="text-3xl font-bold text-amber-900"></h1>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-3">
        <!-- עמודת צד - פרטים ופעולות -->
        <div class="space-y-6">
          <div
            class="bg-white/90 backdrop-blur-sm shadow-xl border border-amber-100 rounded-2xl"
          >
            <div class="border-b border-amber-100 px-6 py-4">
              <h2 class="text-lg text-amber-900 font-bold">פרטים נוספים</h2>
            </div>
            <div class="border-b border-amber-100 px-6 py-4 text-black">
              <div id="detailsContent" class="space-y-2"></div>
              <!-- פעולות מיקום -->
              <div id="locationButtons" class="mt-4 flex flex-col gap-3"></div>
            </div>
          </div>
        </div>

        <!-- עמודת תוכן עיקרי -->
        <div class="lg:col-span-2 space-y-3 flex flex-col">
          <!-- תיאור המקום -->
          <div
            class="bg-white/90 backdrop-blur-sm shadow-xl border border-amber-100 rounded-2xl transition-all duration-300"
          >
            <div class="border-b border-amber-100 px-6 py-4">
              <h2 class="text-xl text-amber-900 font-bold">תיאור המקום</h2>
            </div>
            <div class="p-4">
              <div
                id="descriptionContent"
                class="prose max-w-none text-right text-slate-800 leading-relaxed"
              ></div>
            </div>
          </div>

          <!-- ביוגרפיה -->
          <div
            class="bg-white/90 backdrop-blur-sm shadow-xl border border-amber-100 rounded-2xl transition-all duration-300"
          >
            <div class="border-b border-amber-100 px-6 py-4">
              <h2 class="text-xl text-amber-900 font-bold">ביוגרפיה</h2>
            </div>
            <div class="p-4">
              <div
                id="biographyContent"
                class="prose max-w-none text-right text-slate-800 leading-relaxed"
              ></div>
            </div>
          </div>

          <!-- ספרים -->
          <div
            class="bg-white/90 backdrop-blur-sm shadow-xl border border-amber-100 rounded-2xl transition-all duration-300"
          >
            <div class="border-b border-amber-100 px-6 py-4">
              <h2 class="text-xl text-amber-900 font-bold">ספרים</h2>
            </div>
            <div class="p-4">
              <div id="booksContent"></div>
            </div>
          </div>

          <!-- מאמרים -->
          <div
            class="bg-white/90 backdrop-blur-sm shadow-xl border border-amber-100 rounded-2xl transition-all duration-300"
          >
            <div class="border-b border-amber-100 px-6 py-4">
              <h2 class="text-xl text-amber-900 font-bold">מאמרים</h2>
            </div>
            <div class="p-4">
              <div id="articlesContent"></div>
            </div>
          </div>

          <!-- תמונה ראשית -->
          <div
            id="mainImageSection"
            class="bg-white/90 backdrop-blur-sm shadow-xl border border-amber-100 rounded-2xl hidden"
          >
            <div class="border-b border-amber-100 px-6 py-4">
              <h2 class="text-xl text-amber-900 font-bold">תמונה ראשית</h2>
            </div>
            <div class="p-6 flex justify-center">
              <img
                id="mainImage"
                src=""
                alt=""
                class="rounded-lg max-h-64 cursor-pointer hover:opacity-90 transition"
                onclick="openImageModal(this.src)"
              />
            </div>
          </div>

          <!-- תמונות נוספות -->
          <div
            id="imagesSection"
            class="bg-white/90 backdrop-blur-sm shadow-xl border border-amber-100 rounded-2xl hidden"
          >
            <div class="border-b border-amber-100 px-6 py-4">
              <h2 class="text-xl text-amber-900 font-bold">תמונות נוספות</h2>
            </div>
            <div class="p-6 carousel-container">
              <div
                class="carousel-btn prev"
                onclick="scrollCarousel(-1)"
                style="display: none"
              >
                <svg
                  class="w-6 h-6 text-amber-900"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15 19l-7-7 7-7"
                  />
                </svg>
              </div>
              <div id="imagesGallery" class="carousel-track"></div>
              <div
                class="carousel-btn next"
                onclick="scrollCarousel(1)"
                style="display: none"
              >
                <svg
                  class="w-6 h-6 text-amber-900"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M9 5l7 7-7 7"
                  />
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let allData = [];
      let currentCarouselIndex = 0;
      let totalCarouselImages = 0;

      // נתוני דוגמה לפיתוח
    //   const DEMO_TZADIK = {
    //     id: 999,
    //     name: "יוסף חיים",
    //     gender: "male",
    //     community: { name: "בגדד" },
    //     birthDate: "1835-09-04",
    //     birthDateHebrew: "כד באלול תקצ",
    //     deathDate: "1909-08-30",
    //     deathDateHebrew: "א באלול תרס",
    //     country: "עיראק",
    //     city: "בגדד",
    //     location: [33.3152, 44.3661],
    //     descriptionPlace:
    //       "קברו של הבן איש חי נמצא בבית הקברות היהודי העתיק בבגדד, עיראק. המקום היה אתר עלייה לרגל חשוב ליהודי עיראק במשך דורות.\n\nלאחר עזיבת רוב יהודי עיראק, המקום נשמר על ידי הקהילה היהודית הקטנה שנותרה בבגדד.",
    //     biography: [
    //       "רבי יוסף חיים מבגדד, המכונה 'בן איש חי' על שם ספרו המפורסם, היה מגדולי הפוסקים והמקובלים בעדות המזרח במאה ה-19.",
    //       "נולד בבגדד לאביו רבי אליהו חיים, ראש הישיבה. כבר מגיל צעיר התבלט בחריפותו ובקיאותו העצומה בכל חלקי התורה.",
    //       "בשנת 1859 התמנה לרב הראשי של בגדד, תפקיד בו כיהן עד יום פטירתו. תחת הנהגתו התפתחה הקהילה היהודית בבגדד והפכה למרכז תורני חשוב.",
    //       "חיבר למעלה מ-60 ספרים בכל תחומי התורה - הלכה, קבלה, דרוש ומוסר. ספרו 'בן איש חי' הפך לספר ההלכה המרכזי בקרב יהודי עדות המזרח.",
    //       'נפטר בבגדד ביום ראש חודש אלול תרס"ט, ומאז נחשב לאחד מגדולי הצדיקים של עדות המזרח. ציונו מהווה אתר עלייה לרגל ליהודים רבים.',
    //     ],
    //     books: [
    //       "בן איש חי - הלכות למעשה לכל ימות השנה",
    //       'רב פעלים - שו"ת בארבעה חלקים',
    //       "בן יהוידע - חידושים על האגדות בתלמוד הבבלי",
    //       "עוד יוסף חי - דרושים על פרשות התורה",
    //       "לשון חכמים - פירוש על מסכת אבות",
    //       "אדרת אליהו - קונטרסים קבליים",
    //       "חסד לאברהם - קונטרסים שונים",
    //     ],
    //     article: [
    //       "דיני ברכות והלכות קריאת שמע ותפילה",
    //       "הלכות שבת וימים טובים למעשה",
    //       "דיני נידה וטהרת המשפחה",
    //       "הלכות כשרות ומאכלות אסורות",
    //       "סודות התורה והקבלה המעשית",
    //     ],
    //   };

      // טעינת הנתונים
      async function loadData() {
        try {
          const response = await fetch("data.json");
          const data = await response.json();
          allData = data.tzadikim;

          // קבלת ה-ID מה-URL
          const urlParams = new URLSearchParams(window.location.search);
          const id = urlParams.get("id");

          if (id) {
            const tzadik = allData.find((t) => t.id === parseInt(id));
            if (tzadik) {
              renderTzadik(tzadik);
            } else {
              showNotFound();
            }
          } else {
            showNotFound();
          }
        } catch (error) {
          console.error("Error loading data:", error);
          showNotFound();
        }
      }

      function getTitle(tzadik) {
        if (tzadik.gender === "female" && tzadik.community?.name) {
          const comm = tzadik.community.name.trim();
          return comm.includes("תימן") ? "מרת" : "הרבנית";
        }
        if (tzadik.gender === "male" && tzadik.community?.name) {
          const comm = tzadik.community.name.trim();
          return comm.includes("תימן") ? "מורי" : "רבי";
        }
        return "";
      }

      // פונקציה לבדיקה אם תמונה קיימת
      async function imageExists(url) {
        try {
          const response = await fetch(url, { method: "HEAD" });
          return response.ok;
        } catch {
          return false;
        }
      }

      // פונקציה לטעינת תמונות מתיקיית הצדיק
      async function loadTzadikImages(tzadikId) {
        const images = [];
        let imageNumber = 1;
        const maxImagesToCheck = 20; // מקסימום תמונות לבדוק

        while (imageNumber <= maxImagesToCheck) {
          const imagePath = `./images/${tzadikId}/${imageNumber}.jpg`;
          const exists = await imageExists(imagePath);

          if (exists) {
            images.push(imagePath);
            imageNumber++;
          } else {
            // אם לא מצאנו תמונה, מפסיקים
            break;
          }
        }

        return images;
      }

      // פונקציות למודל תצוגה מלאה
      function openImageModal(imageSrc) {
        document.getElementById("modalImage").src = imageSrc;
        document.getElementById("imageModal").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeImageModal() {
        document.getElementById("imageModal").classList.remove("active");
        document.body.style.overflow = "auto";
      }

      // סגירה בלחיצה על ESC
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeImageModal();
        }
      });

      // סגירה בלחיצה על הרקע
      document
        .getElementById("imageModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeImageModal();
          }
        });

      // פונקציות לקרוסלה
      function scrollCarousel(direction) {
        const gallery = document.getElementById("imagesGallery");
        const itemWidth = 200 + 12; // width + gap
        currentCarouselIndex += direction;

        // גבולות
        if (currentCarouselIndex < 0) currentCarouselIndex = 0;
        if (currentCarouselIndex > totalCarouselImages - 1)
          currentCarouselIndex = totalCarouselImages - 1;

        gallery.style.transform = `translateX(${
          currentCarouselIndex * itemWidth
        }px)`;
        updateCarouselButtons();
      }

      function updateCarouselButtons() {
        const prevBtn = document.querySelector(".carousel-btn.prev");
        const nextBtn = document.querySelector(".carousel-btn.next");

        if (totalCarouselImages > 2) {
          prevBtn.style.display = currentCarouselIndex > 0 ? "flex" : "none";
          nextBtn.style.display =
            currentCarouselIndex < totalCarouselImages - 2 ? "flex" : "none";
        }
      }

      async function renderTzadik(tzadik) {
        // כותרת
        const title = getTitle(tzadik);
        const honorific = tzadik.gender === "male" ? 'זצ"ל' : 'ע"ה';
        document.getElementById(
          "tzadikTitle"
        ).textContent = `${title} ${tzadik.name} ${honorific}`;
        document.title = `${tzadik.name} - הבלוג של הצדיקים`;

        // פרטים
        const detailsHtml = [];

        if (tzadik.birthDate || tzadik.birthDateHebrew) {
          const gregorian = tzadik.birthDate
            ? new Date(tzadik.birthDate).toLocaleDateString("he-IL")
            : "";
          const hebrew = tzadik.birthDateHebrew || "";

          let dateText = "";
          if (hebrew && gregorian) {
            dateText = `${hebrew} | ${gregorian}`;
          } else if (hebrew) {
            dateText = hebrew;
          } else if (gregorian) {
            dateText = gregorian;
          }

          if (dateText) {
            detailsHtml.push(`
              <div>
                <span class="font-medium text-amber-800">תאריך לידה: </span>
                ${dateText}
              </div>
            `);
          }
        }

        if (tzadik.deathDate || tzadik.deathDateHebrew) {
          const gregorian = tzadik.deathDate
            ? new Date(tzadik.deathDate).toLocaleDateString("he-IL")
            : "";
          const hebrew = tzadik.deathDateHebrew || "";

          let dateText = "";
          if (hebrew && gregorian) {
            dateText = `${hebrew} | ${gregorian}`;
          } else if (hebrew) {
            dateText = hebrew;
          } else if (gregorian) {
            dateText = gregorian;
          }

          if (dateText) {
            detailsHtml.push(`
              <div>
                <span class="font-medium text-amber-800">תאריך פטירה: </span>
                ${dateText}
              </div>
            `);
          }
        }

        if (tzadik.country) {
          detailsHtml.push(`
            <div>
              <span class="font-medium text-amber-800">מדינה: </span>
              ${tzadik.country}
            </div>
          `);
        }

        if (tzadik.city) {
          detailsHtml.push(`
            <div>
              <span class="font-medium text-amber-800">עיר: </span>
              ${tzadik.city}
            </div>
          `);
        }

        if (tzadik.community?.name) {
          detailsHtml.push(`
            <div>
              <span class="font-medium text-amber-800">קהילה: </span>
              ${tzadik.community.name}
            </div>
          `);
        }

        document.getElementById("detailsContent").innerHTML =
          detailsHtml.length > 0
            ? detailsHtml.join("")
            : '<p class="text-slate-500 italic text-center">אין מידע זמין</p>';

        // כפתורי מיקום
        if (
          tzadik.location &&
          tzadik.location.length >= 2 &&
          tzadik.location[0]
        ) {
          document.getElementById("locationButtons").innerHTML = `
            <a
              href="https://maps.google.com/?q=${tzadik.location[0]},${tzadik.location[1]}"
              target="_blank"
              rel="noopener noreferrer"
              class="px-3 py-2 rounded-full bg-green-500 text-white font-semibold shadow hover:bg-green-600 transition text-sm text-center"
            >
              פתח ב-Google Maps
            </a>
            <a
              href="https://waze.com/ul?ll=${tzadik.location[0]},${tzadik.location[1]}&navigate=yes"
              target="_blank"
              rel="noopener noreferrer"
              class="px-3 py-2 rounded-full bg-blue-600 text-white font-semibold shadow hover:bg-blue-700 transition text-sm text-center"
            >
              פתח ב-Waze
            </a>
          `;
        }

        // בדיקה אילו סקשנים יש בהם מידע
        const hasDescription =
          tzadik.descriptionPlace && tzadik.descriptionPlace.trim();
        const hasBiography =
          tzadik.biography &&
          Array.isArray(tzadik.biography) &&
          tzadik.biography.length > 0;
        const hasBooks =
          tzadik.books &&
          Array.isArray(tzadik.books) &&
          tzadik.books.length > 0;
        const hasArticles =
          tzadik.article &&
          Array.isArray(tzadik.article) &&
          tzadik.article.length > 0;

        // תיאור המקום
        const descriptionSection = document
          .getElementById("descriptionContent")
          .closest(".bg-white\\/90");
        if (hasDescription) {
          document.getElementById(
            "descriptionContent"
          ).innerHTML = `<p class="mb-4 last:mb-0 whitespace-pre-line">${tzadik.descriptionPlace}</p>`;
          descriptionSection.classList.remove("scale-95", "opacity-80");
        } else {
          document.getElementById("descriptionContent").innerHTML =
            '<p class="text-slate-500 italic text-center text-sm">אין מידע זמין</p>';
          descriptionSection.classList.add("scale-95", "opacity-80");
          descriptionSection.style.order = "100";
        }

        // ביוגרפיה
        const biographySection = document
          .getElementById("biographyContent")
          .closest(".bg-white\\/90");
        if (hasBiography) {
          document.getElementById("biographyContent").innerHTML =
            tzadik.biography
              .map((p) => `<p class="mb-4 last:mb-0">${p}</p>`)
              .join("");
          biographySection.classList.remove("scale-95", "opacity-80");
        } else {
          document.getElementById("biographyContent").innerHTML =
            '<p class="text-slate-500 italic text-center text-sm">אין מידע זמין</p>';
          biographySection.classList.add("scale-95", "opacity-80");
          biographySection.style.order = "101";
        }

        // ספרים
        const booksSection = document
          .getElementById("booksContent")
          .closest(".bg-white\\/90");
        if (hasBooks) {
          document.getElementById("booksContent").innerHTML = `
            <ul class="space-y-2">
              ${tzadik.books
                .map(
                  (book) => `
                <li class="flex items-center gap-3 text-amber-900">
                  <div class="w-2 h-2 bg-amber-600 rounded-full"></div>
                  <span>${book}</span>
                </li>
              `
                )
                .join("")}
            </ul>
          `;
          booksSection.classList.remove("scale-95", "opacity-80");
        } else {
          document.getElementById("booksContent").innerHTML =
            '<p class="text-slate-500 italic text-center text-sm">אין מידע זמין</p>';
          booksSection.classList.add("scale-95", "opacity-80");
          booksSection.style.order = "102";
        }

        // מאמרים
        const articlesSection = document
          .getElementById("articlesContent")
          .closest(".bg-white\\/90");
        if (hasArticles) {
          document.getElementById("articlesContent").innerHTML = `
            <ul class="space-y-2">
              ${tzadik.article
                .map(
                  (article) => `
                <li class="flex items-center gap-3 text-amber-900">
                  <div class="w-2 h-2 bg-amber-600 rounded-full"></div>
                  <span>${article}</span>
                </li>
              `
                )
                .join("")}
            </ul>
          `;
          articlesSection.classList.remove("scale-95", "opacity-80");
        } else {
          document.getElementById("articlesContent").innerHTML =
            '<p class="text-slate-500 italic text-center text-sm">אין מידע זמין</p>';
          articlesSection.classList.add("scale-95", "opacity-80");
          articlesSection.style.order = "103";
        }

        // תמונה ראשית
        const tzadikImages = await loadTzadikImages(tzadik.id);

        if (tzadikImages.length > 0) {
          document
            .getElementById("mainImageSection")
            .classList.remove("hidden");
          document.getElementById("mainImage").src = tzadikImages[0];
          document.getElementById("mainImage").alt = tzadik.name;
        }

        // תמונות נוספות
        if (tzadikImages.length > 1) {
          const additionalImages = tzadikImages.slice(1);
          totalCarouselImages = additionalImages.length;
          currentCarouselIndex = 0;

          document.getElementById("imagesSection").classList.remove("hidden");
          document.getElementById("imagesGallery").innerHTML = additionalImages
            .map(
              (img, i) => `
              <div class="carousel-item">
                <img
                  src="${img}"
                  alt="תמונה ${i + 2}"
                  class="rounded max-h-32 w-full object-cover border cursor-pointer hover:opacity-90 transition"
                  onclick="openImageModal('${img}')"
                />
              </div>
            `
            )
            .join("");

          updateCarouselButtons();
        }
      }

      function showNotFound() {
        document.getElementById("tzadikTitle").textContent = "צדיק לא נמצא";
        document.querySelector(".max-w-4xl").innerHTML = `
          <div class="text-center py-12">
            <h1 class="text-3xl font-bold text-amber-900 mb-4">הצדיק לא נמצא</h1>
            <p class="text-amber-800 mb-6">מצטערים, לא מצאנו את הצדיק שחיפשת</p>
            <a href="index.html" class="px-6 py-3 rounded-xl bg-gradient-to-r from-amber-700 to-amber-800 text-white font-semibold shadow hover:shadow-lg transition">
              חזרה לרשימה
            </a>
          </div>
        `;
      }

      // לטעון נתונים אמיתיים
      loadData();

      // נתוני דמו
    //   (async function init() {
    //     // טוען מיד את נתוני הדמו
    //     await renderTzadik(DEMO_TZADIK);
    //   })();
    </script>
  </body>
</html>
